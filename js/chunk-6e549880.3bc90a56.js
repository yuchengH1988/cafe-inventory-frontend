(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e549880"],{6923:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container py-5 scrollbar"},[a("h2",{staticClass:"ml-4"},[t._v("資料分析")]),t.isLoading?a("Spinner"):[t.chartsData.data.length?a("BarCharts",{attrs:{initData:t.chartsData}}):t._e(),a("div",{staticClass:"filter-wrapper d-flex justify-content-center mt-3"},[a("span",[t._v("月份：")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.month,expression:"month"}],staticClass:"form-select form-select-sm mx-2",attrs:{"aria-label":".form-select-sm example"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.month=e.target.multiple?a:a[0]},t.fetchData]}},t._l(t.months,(function(e){return a("option",{key:e.value,domProps:{value:e.value}},[t._v(" "+t._s(e.name)+" ")])})),0),a("span",{staticClass:"mx-2"},[t._v("營業天數："+t._s(t.records.length)+"天")]),a("span",{staticClass:"ml-4"},[t._v("物料種類：")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.ingredientId,expression:"ingredientId"}],staticClass:"form-select form-select-sm mx-2",attrs:{"aria-label":".form-select-sm example"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.ingredientId=e.target.multiple?a:a[0]},t.fetchData]}},t._l(t.ingredients,(function(e){return a("option",{key:e._id,domProps:{value:e._id}},[t._v(" "+t._s(e.name)+" ")])})),0),a("span",{staticClass:"ml-4"},[t._v("單位：")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.unitSet,expression:"unitSet"}],staticClass:"form-select form-select-sm mx-2",attrs:{"aria-label":".form-select-sm example"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.unitSet=e.target.multiple?a:a[0]},t.fetchData]}},[a("option",{domProps:{value:t.ingredient.unit}},[t._v(" "+t._s(t.ingredient.unitName)+" ")]),a("option",{domProps:{value:t.ingredient.unit2}},[t._v(" "+t._s(t.ingredient.unit2Name)+" ")])])]),a("div",{staticClass:"result-form mt-3 p-3 w-50",staticStyle:{"font-size":"15px"}},[a("table",{staticClass:"table form-group"},[a("thead",[a("tr",{staticClass:"table-info"},[a("th",[t._v(t._s(t.ingredient.name)+"分析表")]),a("th",[t._v("月總量")]),a("th",[t._v("日平均")])])]),a("tbody",[a("tr",[a("th",{attrs:{scope:"row"}},[t._v("實際量")]),a("td",[t._v(t._s(t.statisticNumbers.actualUsed))]),a("td",[t._v(" "+t._s(Math.round(t.statisticNumbers.actualUsed/t.records.length))+" ")])]),a("tr",[a("th",{attrs:{scope:"row"}},[t._v("應用量")]),a("td",[t._v(t._s(t.statisticNumbers.estimateUsed))]),a("td",[t._v(" "+t._s(Math.round(t.statisticNumbers.estimateUsed/t.records.length))+" ")])]),a("tr",[a("th",{attrs:{scope:"row"}},[t._v("誤差量")]),a("td",[t._v(t._s(t.statisticNumbers.errorUsed))]),a("td",[t._v(" "+t._s(Math.round(t.statisticNumbers.errorUsed/t.records.length))+" ")])])])])])]],2)},r=[],n=a("b85c"),i=a("1da1"),c=(a("96cf"),a("d3b7"),a("25f0"),a("7db0"),a("99af"),a("b0c0"),a("159b"),a("b680"),a("c365")),o=a("2fa3"),u=a("c1df"),l=a.n(u),d=a("2375"),m=a("7733"),h={name:"Charts",components:{Spinner:d["a"],BarCharts:m["a"]},data:function(){return{ingredients:[],ingredient:{},isLoading:!0,year:"",month:"",years:[],months:[],ingredientId:"",chartsData:{},records:[],statisticNumbers:{},unitSet:1}},created:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.month=l()().format("MM"),t.year=l()().format("YYYY"),e.next=4,t.fetchIngredients();case 4:return e.next=6,t.fetchData();case 6:for(t.years=[l()().format("YYYY"),l()().add(-1,"y").format("YYYY")],a=1;a<=12;a++)s=a,s=a<10?"0"+a:s.toString(),t.months.push({value:s,name:a+"月"});case 8:case"end":return e.stop()}}),e)})))()},methods:{fetchData:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.chartsData.data=[],t.ingredientId||(t.ingredientId=t.ingredients[0]._id),t.ingredient=t.ingredients.find((function(e){return e._id===t.ingredientId})),e.next=6,c["a"].getRecords({year:t.year,month:t.month,ingredientId:t.ingredientId});case 6:a=e.sent,s=a.data,t.records=s.records,t.createLabels(),t.createData(),t.statisticalCalculator(),1!==t.unitSet?t.chartsData.label="誤差值 (".concat(t.ingredient.unit2Name,")"):t.chartsData.label="誤差值 (".concat(t.ingredient.unitName,")"),t.chartsData.title="".concat(t.ingredient.name,"   ").concat(t.year,"/").concat(t.month),t.isLoading=!1,e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](0),t.isLoading=!1,o["a"].fire({icon:"error",title:"無法載入資料"});case 21:case"end":return e.stop()}}),e,null,[[0,17]])})))()},createLabels:function(){this.chartsData.labels=[];for(var t=new Date(this.year,this.month,0).getDate(),e=new Date(this.year,this.month,1),a=-t;a<0;a++)this.chartsData.labels.push(l()(e).add(a,"d").format("MM/DD"))},createData:function(){var t=this;this.chartsData.data=[];for(var e=this.chartsData.labels.length,a=[],s=1;s<=e;s++){var r=this.year+this.month;r+=s<10?"0"+s:s,a.push(r)}for(var n=function(e){t.chartsData.data.push(0),t.records.forEach((function(s){s.dateId===a[e]&&(t.chartsData.data[e]=s.actualUsed-s.estimateUsed,1!==t.unitSet&&(t.chartsData.data[e]=t.numUnit2(t.chartsData.data[e])))}))},i=0;i<a.length;i++)n(i)},fetchIngredients:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].getIngredients({});case 3:a=e.sent,t.ingredients=a.data.ingredients,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),o["a"].fire({icon:"error",title:"無法讀取物料資訊，請稍後再試"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},statisticalCalculator:function(){this.statisticNumbers.actualUsed=0,this.statisticNumbers.estimateUsed=0;var t,e=Object(n["a"])(this.records);try{for(e.s();!(t=e.n()).done;){var a=t.value;this.statisticNumbers.actualUsed+=a.actualUsed,this.statisticNumbers.estimateUsed+=a.estimateUsed}}catch(s){e.e(s)}finally{e.f()}this.statisticNumbers.errorUsed=this.statisticNumbers.actualUsed-this.statisticNumbers.estimateUsed,1!==this.unitSet&&(this.statisticNumbers.actualUsed=this.numUnit2(this.statisticNumbers.actualUsed),this.statisticNumbers.estimateUsed=this.numUnit2(this.statisticNumbers.estimateUsed),this.statisticNumbers.errorUsed=this.numUnit2(this.statisticNumbers.errorUsed))},numUnit2:function(t){return t=(t/this.unitSet).toFixed(2),t}}},f=h,v=(a("8400"),a("2877")),p=Object(v["a"])(f,s,r,!1,null,"41659464",null);e["default"]=p.exports},8400:function(t,e,a){"use strict";a("f511")},f511:function(t,e,a){}}]);
//# sourceMappingURL=chunk-6e549880.3bc90a56.js.map