(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-65b0893a"],{"0c12":function(t,n,e){"use strict";e.r(n);var i=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"container py-5"},[e("div",{staticClass:"nav-wrapper d-flex"},[e("AdminTab"),e("DataTab")],1),t.isLoading?e("Spinner"):[e("div",{staticClass:"composition-main mt-3 d-flex align-items-start"},[e("div",{staticClass:"products-wrapper"},[e("div",{staticClass:"title"},[t._v("Select Product")]),t._l(t.products,(function(n){return e("div",{key:n._id,staticClass:"product-row"},[e("span",{staticClass:"product-name"},[t._v(t._s(n.name))]),e("button",{staticClass:"btn btn-info btn-sm ml-auto",attrs:{type:"button"},on:{click:function(e){return t.fetchComponents(n._id)}}},[t._v(" Edit ")])])}))],2),t.isEditing?e("div",{staticClass:"ingredients-wrapper ml-4 text-center"},[e("div",{staticClass:"title"},[t._v(t._s(t.editProduct.name))]),t._l(t.components,(function(n){return e("div",{key:n._id,staticClass:"product-row d-flex justify-content-between"},[e("span",{staticClass:"ingredient-name"},[t._v(t._s(n.ingredientName)+"("+t._s(n.ingredientUnit)+")")]),e("input",{directives:[{name:"model",rawName:"v-model",value:n.quantity,expression:"component.quantity"}],staticClass:"quantity form-control w-25",attrs:{type:"number"},domProps:{value:n.quantity},on:{input:function(e){e.target.composing||t.$set(n,"quantity",e.target.value)}}}),e("button",{staticClass:"btn btn-info btn-sm",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return t.updateComposition(n)}}},[t._v(" "+t._s(0!=n.quantity?"save":"delete")+" ")])])})),e("div",{staticClass:"buttons-wrapper d-flex p-3"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.newIngredientId,expression:"newIngredientId"}],staticClass:"form-select",attrs:{"aria-label":"new ingredient"},on:{change:function(n){var e=Array.prototype.filter.call(n.target.options,(function(t){return t.selected})).map((function(t){var n="_value"in t?t._value:t.value;return n}));t.newIngredientId=n.target.multiple?e:e[0]}}},[e("option",{attrs:{value:"",selected:""}},[t._v("新增成份")]),t._l(t.ingredients,(function(n){return e("option",{key:n._id,domProps:{value:n._id}},[t._v(" "+t._s(n.name)+" ")])}))],2),e("button",{staticClass:"btn btn-info btn-sm ml-auto",on:{click:t.addIngredient}},[t._v(" Add ")])]),e("button",{staticClass:"btn btn-warning btn-sm",on:{click:t.cancelEdit}},[t._v(" Cancel ")])],2):t._e()])]],2)},r=[],a=e("1da1"),s=(e("4de4"),e("d81d"),e("159b"),e("b0c0"),e("7db0"),e("96cf"),e("bbff")),o=e("5158"),c=e("c365"),d=e("2375"),u=e("2fa3"),l=e("be6c"),p={name:"Admin-Data",components:{Spinner:d["a"],AdminTab:s["a"],DataTab:o["a"]},data:function(){return{products:[],editProduct:{},components:[],ingredients:[],newIngredientId:"",compositions:[],isLoading:!0,isEditing:!1,isProcessing:!1}},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,e={},n.next=4,c["a"].getProducts();case 4:return e=n.sent,t.products=e.data.products,n.next=8,c["a"].getIngredients();case 8:e=n.sent,t.ingredients=e.data.ingredients,t.fetchCompositions(),t.isLoading=!1,n.next=18;break;case 14:n.prev=14,n.t0=n["catch"](0),t.isLoading=!1,u["a"].fire({icon:"error",title:"無法載入後台資料"});case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))()},fetchCompositions:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,e={},n.next=4,l["a"].compositions.get();case 4:e=n.sent,t.compositions=e.data.compositions,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),u["a"].fire({icon:"error",title:"無法載入成份資料"});case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},fetchComponents:function(t){var n=this;this.resetEditData(),this.isEditing=!0,this.components=this.compositions.filter((function(n){return t===n.productId})),this.components=this.components.map((function(t){return n.ingredients.forEach((function(n){n._id===t.ingredientId&&(t.ingredientName=n.name,t.ingredientUnit=n.unitName)})),t})),this.editProduct=this.products.find((function(n){return t===n._id}))},cancelEdit:function(){this.isEditing=!1,this.resetEditData()},resetEditData:function(){this.editProduct={},this.components=[]},updateComposition:function(t){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,n.isProcessing=!0,i={},t._id){e.next=14;break}if(0!=t.quantity){e.next=8;break}return n.components=n.components.filter((function(n){return n.ingredientId!==t.ingredientId})),n.isProcessing=!1,e.abrupt("return");case 8:return e.next=10,l["a"].compositions.create({quantity:t.quantity,ingredientId:t.ingredientId,productId:t.productId});case 10:i=e.sent,n.cancelEdit(),e.next=25;break;case 14:if(0!=t.quantity){e.next=22;break}if(!confirm("確定要刪除嗎？這個動作也會刪除相關紀錄")){e.next=20;break}return e.next=18,l["a"].compositions.delete({id:t._id});case 18:i=e.sent,n.components=n.components.filter((function(n){return n.ingredientId!==t.ingredientId}));case 20:e.next=25;break;case 22:return e.next=24,l["a"].compositions.update({id:t._id,quantity:t.quantity});case 24:i=e.sent;case 25:if("success"===i.data.status){e.next=27;break}throw new Error(i.data.message);case 27:u["a"].fire({icon:"success",title:"已更新資料"}),n.fetchCompositions(),n.isProcessing=!1,e.next=36;break;case 32:e.prev=32,e.t0=e["catch"](0),n.isProcessing=!1,u["a"].fire({icon:"error",title:"無法更新成份訊息，請稍後在試"});case 36:case"end":return e.stop()}}),e,null,[[0,32]])})))()},addIngredient:function(){var t=this,n=this.components.find((function(n){return n.ingredientId===t.newIngredientId}));if(n)u["a"].fire({icon:"error",title:"成份已存在在清單內"});else{var e=this.ingredients.find((function(n){return n._id===t.newIngredientId}));this.components.push({_id:0,quantity:0,ingredientId:this.newIngredientId,ingredientUnit:e.unitName,ingredientName:e.name,productId:this.editProduct._id})}}}},m=p,f=(e("6515"),e("2877")),v=Object(f["a"])(m,i,r,!1,null,"9b8c0378",null);n["default"]=v.exports},"1c7b":function(t,n,e){"use strict";e("6745")},2091:function(t,n,e){},4680:function(t,n,e){"use strict";e("a764")},5158:function(t,n,e){"use strict";var i=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("div",{staticClass:"link-wrapper d-flex ml-3"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/admin/data/ingredients"}},[t._v("Ingredients")]),t._v(" | "),e("router-link",{staticClass:"nav-link",attrs:{to:"/admin/data/products"}},[t._v("Products")]),t._v(" | "),e("router-link",{staticClass:"nav-link",attrs:{to:"/admin/data/composition"}},[t._v("Conposition")])],1)])},r=[],a=(e("1c7b"),e("2877")),s={},o=Object(a["a"])(s,i,r,!1,null,"19a7bc4c",null);n["a"]=o.exports},6515:function(t,n,e){"use strict";e("2091")},6745:function(t,n,e){},"7db0":function(t,n,e){"use strict";var i=e("23e7"),r=e("b727").find,a=e("44d2"),s="find",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),i({target:"Array",proto:!0,forced:o},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),a(s)},a764:function(t,n,e){},bbff:function(t,n,e){"use strict";var i=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("div",{staticClass:"link-wrapper d-flex"},[e("router-link",{staticClass:"nav-link",attrs:{to:"/admin/data"}},[t._v("Data")]),t._v(" | "),e("router-link",{staticClass:"nav-link",attrs:{to:"/admin/charts"}},[t._v("Charts")]),t._v(" | "),e("router-link",{staticClass:"nav-link",attrs:{to:"/admin/users"}},[t._v("Users")])],1)])},r=[],a=(e("4680"),e("2877")),s={},o=Object(a["a"])(s,i,r,!1,null,"6e0c3b86",null);n["a"]=o.exports},be6c:function(t,n,e){"use strict";e("b0c0"),e("d3b7"),e("3ca3"),e("ddb0"),e("2b3d"),e("25f0");var i=e("2fa3");n["a"]={ingredients:{update:function(t){var n=t.id,e=t.name,r=t.unit,a=t.unitName,s=t.unit2,o=t.unit2Name;return i["b"].put("/admin/ingredients/".concat(n),{name:e,unit:r,unitName:a,unit2:s,unit2Name:o})},create:function(t){var n=t.name,e=t.unit,r=t.unitName,a=t.unit2,s=t.unit2Name;return i["b"].post("/admin/ingredients",{name:n,unit:e,unitName:r,unit2:a,unit2Name:s})},delete:function(t){var n=t.id;return i["b"].delete("/admin/ingredients/".concat(n))}},products:{update:function(t){var n=t.id,e=t.name,r=t.size,a=t.price;return i["b"].put("/admin/products/".concat(n),{name:e,size:r,price:a})},create:function(t){var n=t.name,e=t.size,r=t.price;return i["b"].post("/admin/products",{name:n,size:e,price:r})},delete:function(t){var n=t.id;return i["b"].delete("/admin/products/".concat(n))}},compositions:{get:function(){return i["b"].get("/admin/compositions")},update:function(t){var n=t.id,e=t.quantity;return i["b"].put("/admin/compositions/".concat(n),{quantity:e})},create:function(t){var n=t.quantity,e=t.ingredientId,r=t.productId;return i["b"].post("/admin/compositions",{quantity:n,ingredientId:e,productId:r})},delete:function(t){var n=t.id;return i["b"].delete("/admin/compositions/".concat(n))}},getRecords:function(t){var n=t.year,e=t.month,r=t.ingredientId,a=t.authorId,s=new URLSearchParams({year:n,month:e,ingredientId:r,authorId:a});return i["b"].get("/admin/records?".concat(s.toString()))},users:{get:function(){return i["b"].get("/admin/users")},toggleAdmin:function(t){var n=t.id;return i["b"].put("/admin/users/".concat(n))},delete:function(t){var n=t.id;return i["b"].delete("/admin/users/".concat(n))},create:function(t){var n=t.formData;return i["b"].post("/admin/users",n)}}}},d81d:function(t,n,e){"use strict";var i=e("23e7"),r=e("b727").map,a=e("1dde"),s=a("map");i({target:"Array",proto:!0,forced:!s},{map:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-65b0893a.8f3ee93a.js.map