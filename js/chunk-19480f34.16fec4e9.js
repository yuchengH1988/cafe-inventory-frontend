(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-19480f34"],{4680:function(t,e,n){"use strict";n("a764")},6135:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container py-5"},[n("AdminTab"),t.isLoading?n("Spinner"):[n("div",{staticClass:"table-wrapper p-4"},[n("router-link",{attrs:{to:"/admin/users/new"}},[n("button",{staticClass:"new-user btn btn-info mb-3"},[t._v("New User")])]),n("table",{staticClass:"table"},[n("thead",{staticClass:"thead table-info"},[n("tr",[n("th",{attrs:{scope:"col"}},[t._v("Acccount")]),n("th",{attrs:{scope:"col"}},[t._v("Name")]),n("th",{attrs:{scope:"col"}},[t._v("Email")]),n("th",{attrs:{scope:"col"}},[t._v("isAdmin")]),n("th",{attrs:{scope:"col"}})])]),n("tbody",t._l(t.users,(function(e){return n("tr",{key:e.id},[n("th",{attrs:{scope:"row"}},[t._v(t._s(e.account))]),n("td",[t._v(t._s(e.name))]),n("td",[t._v(t._s(e.email))]),n("td",[t._v(t._s(e.isAdmin?"Admin":"User"))]),n("td",[t.currentUser._id!==e._id?[n("button",{staticClass:"btn btn-info btn-sm",attrs:{disabled:t.isProcessing},on:{click:function(n){return t.toggleAdmin(e)}}},[t._v(" 權限更換 ")]),n("button",{staticClass:"btn btn-danger btn-sm ml-3",attrs:{disabled:t.isProcessing},on:{click:function(n){return t.deleteUser(e)}}},[t._v(" Delete ")])]:t._e()],2)])})),0)])],1)]],2)},i=[],a=n("1da1"),s=n("5530"),c=(n("4de4"),n("96cf"),n("bbff")),u=n("be6c"),o=n("2fa3"),d=n("2375"),m=n("2f62"),l={name:"Admin-Users",components:{AdminTab:c["a"],Spinner:d["a"]},data:function(){return{isLoading:!0,isProcessing:!1,users:[]}},created:function(){this.fetchUsers()},computed:Object(s["a"])({},Object(m["b"])(["currentUser"])),methods:{fetchUsers:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u["a"].users.get();case 3:n=e.sent,t.users=n.data.users,t.isLoading=!1,e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),t.isLoading=!1,o["a"].fire({icon:"error",title:"無法讀取用者資訊，請稍後再試"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},toggleAdmin:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,u["a"].users.toggleAdmin({id:t._id});case 3:if(r=n.sent,i=r.data,"success"===i.status){n.next=7;break}throw new Error(i.message);case 7:t.isAdmin=!t.isAdmin,o["a"].fire({icon:"success",title:"使用者".concat(t.account,"已更換權限")}),e.isProcessing=!1,n.next=16;break;case 12:n.prev=12,n.t0=n["catch"](0),e.isProcessing=!1,o["a"].fire({icon:"error",title:"無法變動權限，請稍後再試"});case 16:case"end":return n.stop()}}),n,null,[[0,12]])})))()},deleteUser:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,!confirm("確定要刪除使用者嗎？")){n.next=10;break}return n.next=4,u["a"].users.delete({id:t._id});case 4:if(r=n.sent,i=r.data,"success"===i.status){n.next=8;break}throw new Error(i.message);case 8:e.users=e.users.filter((function(e){return e._id!==t._id})),o["a"].fire({icon:"success",title:"使用者".concat(t.account,"已被刪除")});case 10:e.isProcessing=!1,n.next=17;break;case 13:n.prev=13,n.t0=n["catch"](0),e.isProcessing=!1,o["a"].fire({icon:"error",title:"無法變動權限，請稍後再試"});case 17:case"end":return n.stop()}}),n,null,[[0,13]])})))()}}},f=l,b=(n("b442"),n("2877")),p=Object(b["a"])(f,r,i,!1,null,"0e0a11f6",null);e["default"]=p.exports},"91f7":function(t,e,n){},a764:function(t,e,n){},b442:function(t,e,n){"use strict";n("91f7")},bbff:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"link-wrapper d-flex"},[n("router-link",{staticClass:"nav-link",attrs:{to:"/admin/data"}},[t._v("Data")]),t._v(" | "),n("router-link",{staticClass:"nav-link",attrs:{to:"/admin/charts"}},[t._v("Charts")]),t._v(" | "),n("router-link",{staticClass:"nav-link",attrs:{to:"/admin/users"}},[t._v("Users")])],1)])},i=[],a=(n("4680"),n("2877")),s={},c=Object(a["a"])(s,r,i,!1,null,"6e0c3b86",null);e["a"]=c.exports},be6c:function(t,e,n){"use strict";n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("25f0");var r=n("2fa3");e["a"]={ingredients:{update:function(t){var e=t.id,n=t.name,i=t.unit,a=t.unitName,s=t.unit2,c=t.unit2Name;return r["b"].put("/admin/ingredients/".concat(e),{name:n,unit:i,unitName:a,unit2:s,unit2Name:c})},create:function(t){var e=t.name,n=t.unit,i=t.unitName,a=t.unit2,s=t.unit2Name;return r["b"].post("/admin/ingredients",{name:e,unit:n,unitName:i,unit2:a,unit2Name:s})},delete:function(t){var e=t.id;return r["b"].delete("/admin/ingredients/".concat(e))}},products:{update:function(t){var e=t.id,n=t.name,i=t.size,a=t.price;return r["b"].put("/admin/products/".concat(e),{name:n,size:i,price:a})},create:function(t){var e=t.name,n=t.size,i=t.price;return r["b"].post("/admin/products",{name:e,size:n,price:i})},delete:function(t){var e=t.id;return r["b"].delete("/admin/products/".concat(e))}},compositions:{get:function(){return r["b"].get("/admin/compositions")},update:function(t){var e=t.id,n=t.quantity;return r["b"].put("/admin/compositions/".concat(e),{quantity:n})},create:function(t){var e=t.quantity,n=t.ingredientId,i=t.productId;return r["b"].post("/admin/compositions",{quantity:e,ingredientId:n,productId:i})},delete:function(t){var e=t.id;return r["b"].delete("/admin/compositions/".concat(e))}},getRecords:function(t){var e=t.year,n=t.month,i=t.ingredientId,a=t.authorId,s=new URLSearchParams({year:e,month:n,ingredientId:i,authorId:a});return r["b"].get("/admin/records?".concat(s.toString()))},users:{get:function(){return r["b"].get("/admin/users")},toggleAdmin:function(t){var e=t.id;return r["b"].put("/admin/users/".concat(e))},delete:function(t){var e=t.id;return r["b"].delete("/admin/users/".concat(e))},create:function(t){var e=t.formData;return r["b"].post("/admin/users",e)}}}}}]);
//# sourceMappingURL=chunk-19480f34.16fec4e9.js.map