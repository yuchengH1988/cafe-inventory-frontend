(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a11f2582"],{4680:function(t,e,a){"use strict";a("a764")},a764:function(t,e,a){},a773:function(t,e,a){"use strict";a("f657")},bbff:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"link-wrapper d-flex"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/admin/data"}},[t._v("Data")]),t._v(" | "),a("router-link",{staticClass:"nav-link",attrs:{to:"/admin/charts"}},[t._v("Charts")]),t._v(" | "),a("router-link",{staticClass:"nav-link",attrs:{to:"/admin/users"}},[t._v("Users")])],1)])},r=[],s=(a("4680"),a("2877")),i={},c=Object(s["a"])(i,n,r,!1,null,"6e0c3b86",null);e["a"]=c.exports},be6c:function(t,e,a){"use strict";a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("25f0");var n=a("2fa3");e["a"]={ingredients:{update:function(t){var e=t.id,a=t.name,r=t.unit,s=t.unitName,i=t.unit2,c=t.unit2Name;return n["b"].put("/admin/ingredients/".concat(e),{name:a,unit:r,unitName:s,unit2:i,unit2Name:c})},create:function(t){var e=t.name,a=t.unit,r=t.unitName,s=t.unit2,i=t.unit2Name;return n["b"].post("/admin/ingredients",{name:e,unit:a,unitName:r,unit2:s,unit2Name:i})},delete:function(t){var e=t.id;return n["b"].delete("/admin/ingredients/".concat(e))}},products:{update:function(t){var e=t.id,a=t.name,r=t.size,s=t.price;return n["b"].put("/admin/products/".concat(e),{name:a,size:r,price:s})},create:function(t){var e=t.name,a=t.size,r=t.price;return n["b"].post("/admin/products",{name:e,size:a,price:r})},delete:function(t){var e=t.id;return n["b"].delete("/admin/products/".concat(e))}},compositions:{get:function(){return n["b"].get("/admin/compositions")},update:function(t){var e=t.id,a=t.quantity;return n["b"].put("/admin/compositions/".concat(e),{quantity:a})},create:function(t){var e=t.quantity,a=t.ingredientId,r=t.productId;return n["b"].post("/admin/compositions",{quantity:e,ingredientId:a,productId:r})},delete:function(t){var e=t.id;return n["b"].delete("/admin/compositions/".concat(e))}},getRecords:function(t){var e=t.year,a=t.month,r=t.ingredientId,s=t.authorId,i=new URLSearchParams({year:e,month:a,ingredientId:r,authorId:s});return n["b"].get("/admin/records?".concat(i.toString()))},users:{get:function(){return n["b"].get("/admin/users")},toggleAdmin:function(t){var e=t.id;return n["b"].put("/admin/users/".concat(e))},delete:function(t){var e=t.id;return n["b"].delete("/admin/users/".concat(e))},create:function(t){var e=t.formData;return n["b"].post("/admin/users",e)}}}},d45b:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container py-5"},[a("AdminTab"),t.isLoading?a("Spinner"):[t.chartsData.data.length>1?a("BarCharts",{attrs:{initData:t.chartsData}}):t._e(),a("div",{staticClass:"filter-wrapper d-flex justify-content-center mt-3"},[a("span",[t._v("店家")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.userId,expression:"userId"}],staticClass:"form-select form-select-sm mx-2",attrs:{"aria-label":".form-select-sm example"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.userId=e.target.multiple?a:a[0]},t.fetchData]}},t._l(t.users,(function(e){return a("option",{key:e._id,domProps:{value:e._id}},[t._v(" "+t._s(e.name)+" ")])})),0),a("span",[t._v("月份：")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.month,expression:"month"}],staticClass:"form-select form-select-sm mx-2",attrs:{"aria-label":".form-select-sm example"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.month=e.target.multiple?a:a[0]},t.fetchData]}},t._l(t.months,(function(e){return a("option",{key:e.value,domProps:{value:e.value}},[t._v(" "+t._s(e.name)+" ")])})),0),a("span",{staticClass:"mx-2"},[t._v("營業天數："+t._s(t.records.length)+"天")]),a("span",{staticClass:"ml-4"},[t._v("物料種類：")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.ingredientId,expression:"ingredientId"}],staticClass:"form-select form-select-sm mx-2",attrs:{"aria-label":".form-select-sm example"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.ingredientId=e.target.multiple?a:a[0]},t.fetchData]}},t._l(t.ingredients,(function(e){return a("option",{key:e._id,domProps:{value:e._id}},[t._v(" "+t._s(e.name)+" ")])})),0),a("span",{staticClass:"ml-4"},[t._v("單位：")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.unitSet,expression:"unitSet"}],staticClass:"form-select form-select-sm mx-2",attrs:{"aria-label":".form-select-sm example"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.unitSet=e.target.multiple?a:a[0]},t.fetchData]}},[a("option",{domProps:{value:t.ingredient.unit}},[t._v(" "+t._s(t.ingredient.unitName)+" ")]),a("option",{domProps:{value:t.ingredient.unit2}},[t._v(" "+t._s(t.ingredient.unit2Name)+" ")])])]),a("div",{staticClass:"result-form mt-3 p-3 w-50",staticStyle:{"font-size":"15px"}},[a("table",{staticClass:"table form-group"},[a("thead",[a("tr",{staticClass:"table-info"},[a("th",[t._v(t._s(t.ingredient.name)+"分析表")]),a("th",[t._v("月總量")]),a("th",[t._v("日平均")])])]),a("tbody",[a("tr",[a("th",{attrs:{scope:"row"}},[t._v("實際量")]),a("td",[t._v(t._s(t.statisticNumbers.actualUsed))]),a("td",[t._v(" "+t._s(Math.round(t.statisticNumbers.actualUsed/t.records.length))+" ")])]),a("tr",[a("th",{attrs:{scope:"row"}},[t._v("應用量")]),a("td",[t._v(t._s(t.statisticNumbers.estimateUsed))]),a("td",[t._v(" "+t._s(Math.round(t.statisticNumbers.estimateUsed/t.records.length))+" ")])]),a("tr",[a("th",{attrs:{scope:"row"}},[t._v("誤差量")]),a("td",[t._v(t._s(t.statisticNumbers.errorUsed))]),a("td",[t._v(" "+t._s(Math.round(t.statisticNumbers.errorUsed/t.records.length))+" ")])])])])])]],2)},r=[],s=a("b85c"),i=a("1da1"),c=(a("96cf"),a("d3b7"),a("25f0"),a("7db0"),a("99af"),a("b0c0"),a("159b"),a("b680"),a("be6c")),u=a("c365"),o=a("2fa3"),d=a("c1df"),l=a.n(d),m=a("2375"),f=a("7733"),h=a("bbff"),v={name:"Admin-Charts",components:{AdminTab:h["a"],Spinner:m["a"],BarCharts:f["a"]},data:function(){return{ingredients:[],ingredient:{},isLoading:!0,year:"",month:"",years:[],months:[],ingredientId:"",chartsData:{},records:[],statisticNumbers:{},unitSet:1,users:[],userId:""}},created:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t.month=l()().format("MM"),t.year=l()().format("YYYY"),t.years=[l()().format("YYYY"),l()().add(-1,"y").format("YYYY")],a=1;a<=12;a++)n=a,n=a<10?"0"+a:n.toString(),t.months.push({value:n,name:a+"月"});return e.next=6,t.fetchUsers();case 6:return e.next=8,t.fetchIngredients();case 8:return e.next=10,t.fetchData();case 10:case"end":return e.stop()}}),e)})))()},methods:{fetchData:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.chartsData.data=[],t.ingredientId||(t.ingredientId=t.ingredients[0]._id),t.ingredient=t.ingredients.find((function(e){return e._id===t.ingredientId})),e.next=6,c["a"].getRecords({year:t.year,month:t.month,ingredientId:t.ingredientId,authorId:t.userId});case 6:a=e.sent,n=a.data,t.records=n.records,t.createLabels(),t.createData(),t.statisticalCalculator(),1!==t.unitSet?t.chartsData.label="誤差值 (".concat(t.ingredient.unit2Name,")"):t.chartsData.label="誤差值 (".concat(t.ingredient.unitName,")"),t.chartsData.title="".concat(t.ingredient.name,"   ").concat(t.year,"/").concat(t.month),t.isLoading=!1,e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](0),t.isLoading=!1,o["a"].fire({icon:"error",title:"無法載入資料"});case 21:case"end":return e.stop()}}),e,null,[[0,17]])})))()},createLabels:function(){this.chartsData.labels=[];for(var t=new Date(this.year,this.month,0).getDate(),e=new Date(this.year,this.month,1),a=-t;a<0;a++)this.chartsData.labels.push(l()(e).add(a,"d").format("MM/DD"))},createData:function(){var t=this;this.chartsData.data=[];for(var e=this.chartsData.labels.length,a=[],n=1;n<=e;n++){var r=this.year+this.month;r+=n<10?"0"+n:n,a.push(r)}for(var s=function(e){t.chartsData.data.push(0),t.records.forEach((function(n){n.dateId===a[e]&&(t.chartsData.data[e]=n.actualUsed-n.estimateUsed,1!==t.unitSet&&(t.chartsData.data[e]=t.numUnit2(t.chartsData.data[e])))}))},i=0;i<a.length;i++)s(i)},fetchUsers:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].users.get();case 3:a=e.sent,t.users=a.data.users,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),o["a"].fire({icon:"error",title:"無法讀取用者資訊，請稍後再試"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},fetchIngredients:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u["a"].getIngredients({});case 3:a=e.sent,t.ingredients=a.data.ingredients,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),o["a"].fire({icon:"error",title:"無法讀取物料資訊，請稍後再試"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},statisticalCalculator:function(){this.statisticNumbers.actualUsed=0,this.statisticNumbers.estimateUsed=0;var t,e=Object(s["a"])(this.records);try{for(e.s();!(t=e.n()).done;){var a=t.value;this.statisticNumbers.actualUsed+=a.actualUsed,this.statisticNumbers.estimateUsed+=a.estimateUsed}}catch(n){e.e(n)}finally{e.f()}this.statisticNumbers.errorUsed=this.statisticNumbers.actualUsed-this.statisticNumbers.estimateUsed,1!==this.unitSet&&(this.statisticNumbers.actualUsed=this.numUnit2(this.statisticNumbers.actualUsed),this.statisticNumbers.estimateUsed=this.numUnit2(this.statisticNumbers.estimateUsed),this.statisticNumbers.errorUsed=this.numUnit2(this.statisticNumbers.errorUsed))},numUnit2:function(t){return t=(t/this.unitSet).toFixed(2),t}}},p=v,b=(a("a773"),a("2877")),g=Object(b["a"])(p,n,r,!1,null,"5fec1f0a",null);e["default"]=g.exports},f657:function(t,e,a){}}]);
//# sourceMappingURL=chunk-a11f2582.1b608f3f.js.map